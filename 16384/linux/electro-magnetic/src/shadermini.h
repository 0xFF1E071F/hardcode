static const char GLSLX_SOURCE_MAIN[] = "#version 130\nuniform float ca,h,u;uniform sampler2D B,J,xa;vec3 za(vec2 a,vec2 l,vec2 k,float v){vec2 b=floor(l);vec3 p=vec3(0.);vec2 y=1./abs(k),j=b-l,i=sign(k);j+=max(i,vec2(0.)),j/=k;float z=h*0.;vec3 o=vec3(0.);for(int r=0;r<63;r++){vec2 e=vec2(1.,0.);e=step(j.xy,j.yx),j+=y*e,b+=i*e;vec2 m=b,t=(b-l+(vec2(1.)-i)/2.)/k;float g=0.;g=dot(t*e,vec2(1.))*1.,m=l+k*g;if(length(floor(b-vec2(15.)))>24.+sin(b.x*.3412+z)*9.+sin(b.y*.55213)*9.){float x=dot(e.xy*i.xy,normalize(m-vec2(15.)));vec3 d=vec3(.2,.6,.3)*x;float n=length(b-vec2(15.)),c=-8.+pow(n,1.)*.6;c+=sin(n*.9+u*1.*3.14159),c=max(3.,c),c=n>30.?12.8:c;vec2 q;q.y=-a.y*g+c*2.,q.x=dot(e*m.yx,vec2(1.)),d*=pow(texture2D(J,q*.1).b,2.)*3.,d*=1.-pow(abs(fract(dot(m,i))-.5)*2.,4.);float f=1.6/g;d*=(smoothstep(4.,8.,u)*29.+10.)*30./(g*g);if(r>50&&abs(-a.y-f*2.)>f*12.8){d=vec3(.1,.6,.7);vec4 s=texture2D(J,vec2(-v*6.,a.y)*.1);float w=pow(s.r,19.);d=w*vec3(3.,1.8,2.1)*(.8+sin(h*5.999+s.g*5.9)*.2);}else if(abs(-a.y-f*2.)<f*c)d*=vec3(abs(-a.y-f*2.))*.2+.5;else continue;o=d;if(-a.y<f*2.||-a.y<0.)p.rgb=o;else if(-a.y>0.)p.rgb=vec3(.3,.4,.8)*(20./n)+o*.2;break;}}return p;}vec3 Fa(vec2 d,vec2 e,vec2 a){vec2 f=floor(e);vec3 b=vec3(0.);vec2 v=1./abs(a),c=f-e;a.x>=0.?c.x+=1.:0.,a.y>=0.?c.y+=1.:0.,c/=a,c+=vec2(3.);float i=1.;vec2 n=sign(a),m=vec2(1e+4);float k=1.;for(int q=0;q<20;q++){vec2 g=vec2(1.,0.);g=step(c.xy,c.yx),c+=v*g,f+=n*g;vec2 o=f,w=(f-e+(vec2(1.)-n)/2.)/a;float l=0.;l=dot(w*g,vec2(1.))*1.,o=e+a*l;float r=length(o-d);if(i<.1){b=vec3(.9,.9,.8);break;}k=max(0.,2.-i*2.),k+=max(0.,2.-r*2.),i=r;if(floor(m)==floor(d)){b*=.1,b+=vec3(.4,.5,.3)*1.;break;}m=f;for(float j=0.;j<15.;j+=1.){float s=1./(j*1.+1.);if(floor(f*s)==floor(d*s))b+=vec3(.4,.5,.7)*9e-3;}}float p=step(0.,dot(a.xy,d-e)),t=abs(dot(a.yx*vec2(-1.,1.),d-e))/k;if(t<.05)b+=vec3(.4,.1,.1)*p;if(t<.2)b+=vec3(.4,.1,.1)*p;b+=fract(d.y/4.)*.1;return b;}vec3 Ca(vec3 q,vec3 j){float E=0.;vec3 f=vec3(0.),c=floor(q),p=vec3(1.)/abs(j),a=c-q,d=sign(j);a+=max(d,vec3(0.)),a/=j;int n=0;vec3 F,w,H,I,g=q,e=j;float o=0.,r=0.,x=5.2+h*0.;vec3 y=vec3(15.,15.,15.);y.x+=cos(h)*0.;float L=.5+sin(h*1.)*.05,v,G;for(int z=0;z<2024;z++){vec3 l=vec3(0.);l=step(a.xyz,a.yxy)*step(a.xyz,a.zzx),a+=p*l,c+=d*l;vec3 M=(c-g+(vec3(1.)-d)/2.)/e;float i=0.;i=dot(l,M);vec3 t=c-vec3(15.);float k=length(t),b=0.;b=k>28.?1.:b,b=k>11.&&k<12.&&sin(x+dot(t,vec3(8.4234,8.6346,7.3423)))<0.?2.:b,b=k>4.&&k<5.&&sin(x+dot(t,vec3(8.4234,8.6346,7.3423)))<-.8?2.:b;if(n==0){r=o,o=i;float K=fract(sin(h*42.561232+i*24.23))*.1;vec3 D=g+e*((o+r)*.5+K),m=y-D;v=length(m),m/=v;if(b>.5){float N=max(0.,-dot(l*d,m));f=vec3(3./pow(i,.5)),f=f*0.+dot(f,vec3(1.))*vec3(1.,.6,.2)*.1*N,f*=G,f+=E*vec3(1.,.9,.8)*L;break;}F=c,w=p,H=a,I=d,n=1,g=D,e=m,c=floor(g),p=vec3(1.)/abs(e),a=c-g,d=sign(e),a+=max(d,vec3(0.)),a/=e;}else if(n==1){bool s=false;if(i>v)E+=abs(r-o)/i,s=true;if(b>.5||s)G=s?1.:.8,c=F,p=w,a=H,d=I,n=0,g=q,e=j;}}return f;}vec3 wa(vec2 c){float a=c.y*512.+c.x;vec3 b=vec3(0.);b.x=mod(a,64.),a=(a-b.x)/64.,b.y=mod(a,64.),a=(a-b.y)/64.,b.z=mod(a,64.);return b;}vec2 V(vec3 a){a.y-=4.;float b=(a.z*64.+a.y)*64.+a.x;vec2 c;c.x=mod(b,512.),b=(b-c.x)/512.,c.y=mod(b,512.);return c;}vec4 C(vec3 a){a=floor(a);vec2 b=(V(a)+vec2(.5))/vec2(512.);return texture2D(B,b);}vec3 va(vec3 k,vec3 e){float p=0.;vec3 i=vec3(0.),c=floor(k),s=vec3(1.)/abs(e),a=c-k,f=sign(e);a+=max(f,vec3(0.)),a/=e;float j=0.,o=0.;for(int n=0;n<128;n++){vec3 b=vec3(0.);b=step(a.xyz,a.yxy)*step(a.xyz,a.zzx),a+=s*b,c+=f*b;vec3 r=(c-k+(vec3(1.)-f)/2.)/e;float l=0.;l=dot(b,r);vec3 d=c;float m=min(min(d.x,d.y),d.z);vec3 g=vec3(63.)-d;m=min(m,min(min(g.x,g.y),g.z));if(m<0.)continue;vec2 t=(V(d)+vec2(.5))/vec2(512.);vec4 q=texture2D(B,t);o=j,j=l,p+=length(q.rg)*.1*abs(o-j)/l;if(q.a>.2){i=vec3(.3,.2,.4);vec3 v=c+b*f;vec2 w=(V(v)+vec2(.5))/vec2(512.);vec4 x=texture2D(B,w);i*=length(x.rg)*1.;break;}}return i+p*10.*vec3(1.,.9,.8);}vec2 A(ivec2 a){return texelFetch(B,a,0).rg;}void main(){vec2 N=vec2(640.,480.),ra=vec2(512.,512.);vec3 a=vec3(0.);float X=1.;vec2 l=gl_FragCoord.xy/N,b=(l-vec2(.5))*2.*N/N.x,p=gl_FragCoord.xy/ra;float d=ca;if(ca>199.5){float M=u-36.;M*=1.3;float Ha=b.x+b.y;M*=1.3+sin(floor(Ha*5.)*1.42)*.3,d=106.,d=M>b.x-b.y+2.?100.:d;}if(d<.5){ivec2 k=ivec2(gl_FragCoord.xy);vec2 c;vec3 ma=texelFetch(B,k,0).rgb;vec2 L=ma.rg,Y=A(k+ivec2(-1,0)),Z=A(k+ivec2(1,0)),_=A(k+ivec2(0,-1)),O=A(k+ivec2(0,1)),aa=A(k+ivec2(-1,-1)),pa=A(k+ivec2(1,-1)),oa=A(k+ivec2(-1,1)),la=A(k+ivec2(1,1));c=L;vec2 n=normalize(vec2(1.));float j=Y.r+Z.r+_.r+O.r,W=4.;j+=mix(Y.r,oa.r,n.x),j+=mix(Z.r,la.r,n.x),j+=mix(Y.r,aa.r,n.x),j+=mix(Z.r,pa.r,n.x),j+=mix(_.r,oa.r,n.x),j+=mix(_.r,la.r,n.x),j+=mix(O.r,aa.r,n.x),j+=mix(O.r,pa.r,n.x),W+=8.,j+=L.r,W+=1.,c.g+=j/W-L.r,c.r+=c.g*.9,c.r*=.999;float f=1.;f*=smoothstep(0.,.05,p.y),f*=smoothstep(1.,.95,p.y),f*=smoothstep(0.,.05,p.x),f*=smoothstep(1.,.95,p.x),f*=smoothstep(.2,.3,texture2D(J,p*.04).r),f=length(gl_FragCoord.xy-vec2(128.,350.))<10.?1.:f,f=clamp(f,0.,1.),c.rg*=f;vec2 F=vec2(0.);F.x=cos(h*150.3),F.y=sin(h*150.3);vec2 o=vec2(128.,350.);if(u<4.)o.y-=u*10.;else if(u<20.)o.x=-10.;else if(u<32.){float ia=u-20.;o.x+=350.-ia*50.,o.y+=-300.+ia*50.;}o+=(texture2D(J,p+vec2(.312919,.223512)*h).rg-vec2(.5))*5.,c=mix(c,F,smoothstep(2.,1.,distance(gl_FragCoord.xy,o))),c=distance(gl_FragCoord.xy,o)<1.?F:c,c=u<.1?vec2(0.):c;float ta=.997-pow(clamp(u,0.,1.),.6)*.94,ua=mix(ma.b,length(c),ta);a=vec3(c,ua),X=f;}else if(d<1.5){vec3 e=wa(gl_FragCoord.xy);vec4 g=vec4(0.);g+=C(e+vec3(1.,0.,0.)),g+=C(e+vec3(-1.,0.,0.)),g+=C(e+vec3(0.,1.,0.)),g+=C(e+vec3(0.,-1.,0.)),g+=C(e+vec3(0.,0.,1.)),g+=C(e+vec3(0.,0.,-1.)),g+=C(e+vec3(0.,0.,0.)),g/=vec4(7.);float q=length(e-vec3(32.));vec4 y=vec4(0.);y.a=0.,y.r=1.-clamp((q-20.)*.2,0.,1.),q+=sin(e.x*.4+h*4.)*4.,q+=sin(e.y*.3+h*3.)*3.,q+=sin(e.z*.9+h*7.)*3.,q<15.?y.a=1.:0.;float ha=mod(u,4.),U=smoothstep(2.,1.9,ha);U+=smoothstep(3.8,4.,ha),a=mix(g.rgb,y.rgb,U),X=mix(g.a,y.a,U);}else if(d<100.5){a=vec3(.6,.4,.2)*.1;vec4 da=texture2D(B,l*vec2(1.,.8));a+=pow(da.b,1.)*vec3(2.2,1.3,.4)*10.;vec3 T=texture2D(J,l*.5).rrr*.5;T=pow(T,vec3(2.)),a=mix(vec3(.6,.5,.6-l.y*.5)+T,a,da.a),a=min(vec3(1.5),a);}else if(d<101.5){{float H=h*1.+length(b)*(2.+cos(h*.4)*2.);mat2 Ra=mat2(sin(H),cos(H),-cos(H),sin(H));}vec2 S=normalize(vec2(.5,.5)),Qa=fract(vec2(4.354812)*h+l);float Pa=length(b)*0.,ka=h*.1,s=sin(ka*2.)*.1+3.926988;s+=ka*1.2;mat2 Da=mat2(sin(s),cos(s),-cos(s),sin(s));S=Da*S;vec2 Ea=vec2(15.5);vec3 ja;ja=Fa(b*vec2(15.)+vec2(15.),Ea,S),a=ja*.5;}else if(d<102.5){{float D=h*1.+length(b)*(2.+cos(h*.4)*2.);mat2 Oa=mat2(sin(D),cos(D),-cos(D),sin(D));}vec2 R=normalize(vec2(.5,.5)),Na=fract(vec2(4.354812)*h+l);float Ia=b.x*1./(b.y*.2+4.)*1.9,r=h*.2+Ia;mat2 Ja=mat2(sin(r),cos(r),-cos(r),sin(r));R=Ja*R;float G=h*.4;vec2 v=vec2(15.5);v.x+=cos(G*1.9623)*2.,v.y+=sin(G*1.56423)*2.,v.x-=cos(G*4.1623)*1.,v.y+=sin(G*3.6423)*1.;vec3 ga;ga=za(b,v,R,r),a=ga*.6,a=pow(a,vec3(1.4));}else if(d<103.5){vec3 w=normalize(vec3(b*1.,1.6));float I=sin(h*1.)*.1+1.570795;mat2 Ka=mat2(sin(I),cos(I),-cos(I),sin(I));w.xy=Ka*w.xy,w.xyz=w.xzy*vec3(1.,-1.,1.);vec3 t=vec3(15.5,24.,15.);u>40.?t.y+=13.*min(1.,(u-40.)/8.):0.,t.x+=sin(h*.4)*3.,t.y+=sin(h*.46+1.)*3.,t.z+=sin(h*.432+2.)*3.,a=Ca(t,w).rgb;}else if(d<104.5){a=vec3(.6,.4,.2)*.1;vec4 La=texture2D(B,l);a=La.baa;}else if(d<105.5){vec3 Q=normalize(vec3(b*1.,2.));float K=h*.1;mat2 ea=mat2(sin(K),cos(K),-cos(K),sin(K));Q.xz=ea*Q.xz;float ba=max(0.,u-56.)*4.;vec3 z=vec3(32.5,32.,32.);z.xz+=ea*vec2(0.,-60.-ba),z.x+=sin(h*.4)*3.,z.y+=sin(h*.46+1.)*3.,z.z+=sin(h*.432+2.)*3.,a=va(z,Q)*(1./(ba/32.+1.));}else if(d<106.5){float Ma=length(b)*.4,x=floor(Ma*50.),P=x*6.+3.;P=x>(u-32.)*8.?0.:P;float fa=h*.02,na=u+x*.0538,Ga=smoothstep(0.,.5,fract(na));fa+=(floor(na)+Ga)*.1341;float Ba=fract(4.+atan(b.x,b.y)/6.28318+fa+x/3.235),Aa=pow(floor(Ba*P),2.),ya=pow(x,2.),sa=mod(pow(Aa+ya,2.),100.)/100.;a=vec3(1.,.5,.2)*sa*3.;}if(d>99.5){float i=100.;i=min(i,.9-abs(b.x)),i=min(i,.68-abs(b.y)),i=min(i,.9-dot(b,vec2(.7,.7)));float E=1e+4;E=-.85-dot(b,vec2(.7,.7)),E=max(E,.7+dot(b,vec2(.7,.7))),i=min(i,E),a=mix(a*.2+vec3(0.),a,smoothstep(9e-3,.01,i)),a=mix(a*.2+vec3(.2,.1,.6),a,smoothstep(0.,4e-3,i)),a*=mod(gl_FragCoord.y,2.)*.4+.6,a*=.95+sin(gl_FragCoord.y*.1+h*4.)*.05,a+=vec3(texture2D(J,l+vec2(h*99.3923)).g*.1);float qa=dot(a,vec3(.3333));a=a*.5+qa*vec3(1.,.6,.2)*.5;vec2 m;m.x=b.x+.8,m.y=-b.y+.5,m*=vec2(.39,1.2);if(m.x>=0.&&m.y>=0.&&m.x<1.&&m.y<1.)a+=texture2D(xa,m).rgb;a=pow(a,vec3(1.4));}gl_FragColor=vec4(a,X);}";

static const char GLSLX_NAME_U_TIME[] = "h";
static const char GLSLX_NAME_U_SONGPOS[] = "u";
static const char GLSLX_NAME_U_LASTWAVE[] = "B";
static const char GLSLX_NAME_U_NOISE[] = "J";
static const char GLSLX_NAME_U_PROG[] = "ca";
static const char GLSLX_NAME_U_TEXT[] = "xa";
